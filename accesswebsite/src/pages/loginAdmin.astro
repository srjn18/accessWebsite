---
import "../styles/login.css";
import loginBg from '@assets/homePages/loginBg.png'
import mailIcon from '@assets/icons/mail.svg';
import lockIcon from '@assets/icons/lock.svg';
---

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700&family=Rajdhani:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

<section
  class="bg-img"
  style={`background-image: url(${loginBg.src});`}
>
    <div class="wrapper">
        <form id="adminLoginForm">
          <h1>Admin Login</h1>
          <div class="input-box">
            <input 
              type="email" 
              id="adminEmail"
              placeholder="Email" 
              required 
            />
            <img src={mailIcon.src} alt="user icon" />
          </div>
          <div class="input-box">
            <input 
              type="password" 
              id="adminPassword"
              placeholder="Password" 
              required 
            />
            <img src={lockIcon.src} alt="lock icon" />
          </div>

          <button type="submit" class="access-btn" id="loginBtn">Login</button>

          <div id="loginError" style="color: red; margin-top: 10px; text-align: center; display: none;"></div>
          <div id="loginSuccess" style="color: green; margin-top: 10px; text-align: center; display: none;"></div>

          <div class="goback">
            <a href="/"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 28 28">
	              <path fill="#fff" d="m14 17l-5-5l5-5z" /></svg>Go Back</a>
          </div>
        </form>
    </div>

<script define:vars={{}}>
  console.log('Script is running!');
  
  // Wait for DOM to be ready
  document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM Content Loaded');
    
    const form = document.getElementById('adminLoginForm');
    const emailInput = document.getElementById('adminEmail');
    const passwordInput = document.getElementById('adminPassword');
    const loginBtn = document.getElementById('loginBtn');
    const errorDiv = document.getElementById('loginError');
    const successDiv = document.getElementById('loginSuccess');
    
    console.log('Form element:', form);
    console.log('Email input:', emailInput);
    console.log('Password input:', passwordInput);
    
    if (!form) {
      console.error('Form not found!');
      return;
    }
    
    form.addEventListener('submit', async function(e) {
      console.log('Form submitted!');
      e.preventDefault();
      
      const email = emailInput.value.trim();
      const password = passwordInput.value;
      
      console.log('Email:', email);
      console.log('Password:', password);
      
      // Hide previous messages
      errorDiv.style.display = 'none';
      successDiv.style.display = 'none';
      errorDiv.textContent = '';
      successDiv.textContent = '';
      
      if (!email || !password) {
        errorDiv.textContent = 'Please enter both email and password';
        errorDiv.style.display = 'block';
        return;
      }
      
      try {
        loginBtn.disabled = true;
        loginBtn.textContent = 'Logging in...';
        
        console.log('Sending request to http://localhost:5001/api/login');
        
        const response = await fetch('http://localhost:5001/api/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ email, password })
        });
        
        console.log('Response status:', response.status);
        const data = await response.json();
        console.log('Response data:', data);
        
        if (data.success && data.token) {
          console.log('Login successful!');
          successDiv.textContent = 'Login successful! Redirecting...';
          successDiv.style.display = 'block';
          
          localStorage.setItem('authToken', data.token);
          console.log('Token saved to localStorage');
          
          setTimeout(() => {
            window.location.href = '/admin-dashboard';
          }, 1500);
        } else {
          console.log('Login failed:', data.message);
          errorDiv.textContent = data.message || 'Login failed. Please check your credentials.';
          errorDiv.style.display = 'block';
          
          loginBtn.disabled = false;
          loginBtn.textContent = 'Login';
        }
      } catch (error) {
        console.error('Error caught:', error);
        console.error('Error message:', error.message);
        
        errorDiv.textContent = 'Error: ' + error.message + '. Make sure backend is running on http://localhost:5001';
        errorDiv.style.display = 'block';
        
        loginBtn.disabled = false;
        loginBtn.textContent = 'Login';
      }
    });
  });
</script>

</section>